
# INTEREST POINT DETECTION
# -----------------------------------
xml_file_path_detection: 's3://aind-open-data/exaSPIM_686951_2025-02-25_09-45-02_alignment_2025-06-12_19-58-52/dataset.xml'
image_file_prefix:  's3://aind-open-data/exaSPIM_686951_2025-02-25_09-45-02/SPIM.ome.zarr/'
# broke
# image_file_prefix:  's3://aind-open-data/exaSPIM_686951_2025-02-25_09-45-02_flatfield-correction_2025-06-10_06-58-54/SPIM.ome.zarr'
xml_output_file_path: &detection_xml_output_file_path 's3://martin-test-bucket/exaSPIM_686951/detection/rhapso_detection.xml'
n5_output_file_prefix: &n5_output_file_prefix 's3://martin-test-bucket/exaSPIM_686951/detection/'
detection_run_type: 'ray' 
file_type: 'zarr' 
label: "beads"              # ❌ HARDCODED to "beads" in save_interest_points.py line 70
sigma: 2             
threshold: 0.005     
overlappingOnly: true       # ❌ HARDCODED to "true" in save_interest_points.py line 29
storeIntensities: false     # ❌ NOT IMPLEMENTED - config value ignored
prefetch: false             # ❌ NOT IMPLEMENTED - config value ignored
min_intensity: 1                       
max_intensity: 5    
dsxy: 16
dsz: 16
blocksize: "512,512,128"    # ❌ NOT IMPLEMENTED - config value ignored
type: "MAX"                 # (default:max) ❌ HARDCODED to "list" in save_interest_points.py line 165
localization: "QUADRATIC"   # ❌ NOT IMPLEMENTED - config value ignored
median_filter: 10
max_spots: 8000  
max_spots_per_overlap: true # ❌ HARDCODED to False in advanced_refinement.py line 23
# required for detection
combine_distance: 0.5
chunks_per_bound: 14

## ----------------------------------------------
# SOLVER
# -----------------------------------

n5_input_path: *n5_output_file_prefix
metrics_output_path: "metrics/metrics.json"
fixed_views: ['timepoint: 0, setup: 0']
relative_threshold: 3.5
absolute_threshold: 7.0
min_matches: 3
damp: 1.0
max_iterations: 10000
max_allowed_error: .inf
max_plateauwidth: 200

# -- RIGID --
run_type_solver_rigid: 'rigid'
xml_file_path_solver_rigid: *detection_xml_output_file_path
xml_file_path_output_rigid: &rigid_solver_xml_output 's3://martin-test-bucket/rigid-rhapso-solver-output/rhapso-solver-rigid.xml'

# -- AFFINE --
run_type_solver_affine: 'affine'
xml_file_path_solver_affine: *rigid_solver_xml_output
xml_file_path_output_affine: 's3://martin-test-bucket/rigid-rhapso-solver-output/rhapso-solver-affine.xml'

# INTEREST POINT MATCHING
# -----------------------------------

input_type: 'zarr'
n5_matching_output_path: *n5_output_file_prefix 

# -- RIGID --
match_type_rigid: 'rigid' 
xml_file_path_matching_rigid: *detection_xml_output_file_path

# Candidates 
num_neighbors_rigid: 3
redundancy_rigid: 0
significance_rigid: 3                    # ratio of distance
search_radius_rigid: 300
num_required_neighbors_rigid: 3

# Ransac
model_min_matches_rigid: 18              # min number inlier factor = 6
inlier_factor_rigid: 100                 # max epsilon
lambda_value_rigid: 0.1                  # min inlier ratio
num_iterations_rigid: 10000
regularization_weight_rigid: 1.0

# -- AFFINE --
match_type_affine: 'affine'  
xml_file_path_matching_affine: *rigid_solver_xml_output                 

# Candidates
num_neighbors_affine: 3
redundancy_affine: 0
significance_affine: 3                  # ratio of distance
search_radius_affine: 100
num_required_neighbors_affine: 3

# Ransac     
model_min_matches_affine: 24            # min number inlier factor = 5
inlier_factor_affine: 30                # max epsilon
lambda_value_affine: 0.05               # min inlier ratio
num_iterations_affine: 10000
regularization_weight_affine: 1.0